// Esquema de Prisma para Connect4
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Jugador {
  id                 Int      @id @default(autoincrement())
  identificacion     BigInt   @unique
  nombre             String   @db.VarChar(255)
  partidasGanadas    Int      @default(0) @map("partidas_ganadas")
  partidasPerdidas   Int      @default(0) @map("partidas_perdidas")
  partidasEmpatadas  Int      @default(0) @map("partidas_empatadas")
  marcador           Int      @default(0)
  fechaCreacion      DateTime @default(now()) @map("fecha_creacion") @db.Timestamptz(6)
  fechaActualizacion DateTime @default(now()) @updatedAt @map("fecha_actualizacion") @db.Timestamptz(6)

  // Relaciones
  partidasComoJugador1 Partida[]    @relation("Jugador1")
  partidasComoJugador2 Partida[]    @relation("Jugador2")
  partidasGanador      Partida[]    @relation("Ganador")
  movimientos          Movimiento[]

  @@map("jugadores")
}

model Partida {
  id                 Int      @id @default(autoincrement())
  jugador1Id         Int      @map("jugador1_id")
  jugador2Id         Int      @map("jugador2_id")
  estado             String   @default("en_curso") @db.VarChar(20)
  ganadorId          Int?     @map("ganador_id")
  resultado          String?  @db.VarChar(10)
  tablero            Json     @default("[]") @db.JsonB
  turnoActual        Int      @default(1) @map("turno_actual")
  fechaCreacion      DateTime @default(now()) @map("fecha_creacion") @db.Timestamptz(6)
  fechaActualizacion DateTime @default(now()) @updatedAt @map("fecha_actualizacion") @db.Timestamptz(6)

  // Relaciones
  jugador1    Jugador      @relation("Jugador1", fields: [jugador1Id], references: [id])
  jugador2    Jugador      @relation("Jugador2", fields: [jugador2Id], references: [id])
  ganador     Jugador?     @relation("Ganador", fields: [ganadorId], references: [id])
  movimientos Movimiento[]

  @@map("partidas")
}

model Movimiento {
  id               Int      @id @default(autoincrement())
  partidaId        Int      @map("partida_id")
  jugadorId        Int      @map("jugador_id")
  columnaLetra     String   @map("columna_letra") @db.Char(1)
  filaPosicion     Int      @map("fila_posicion")
  numeroMovimiento Int      @map("numero_movimiento")
  fechaCreacion    DateTime @default(now()) @map("fecha_creacion") @db.Timestamptz(6)

  // Relaciones
  partida Partida @relation(fields: [partidaId], references: [id])
  jugador Jugador @relation(fields: [jugadorId], references: [id])

  @@map("movimientos")
}
